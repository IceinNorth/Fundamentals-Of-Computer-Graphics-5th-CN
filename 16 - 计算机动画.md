# 16 - 计算机动画
动画源自拉丁语anima，意思是赋予生命、兴趣、精神、运动或活动的行为、过程或结果。动作是生命的定义属性，动画的真正艺术是关于如何通过动作来**讲述故事，表达情感，甚至表达人类性格的微妙细节**。计算机是实现这些目标的次要工具——一个熟练的动画师可以用它来帮助更快地得到他想要的结果，**而不必把注意力集中在他不感兴趣的技术上**。
没有电脑的动画，现在通常被称为“传统”动画，有悠久而丰富的历史，数百名仍然活跃在这门艺术中的人不断地写着。正如在任何已建立的领域一样，一些经过时间考验的规则已经具体化，这些规则对某些事情应该如何做以及应该避免什么提供了一般的高级指导。
传统动画的这些原则同样适用于计算机动画，我们将在本章中讨论其中的一些原则。

然而，计算机不仅仅是一个工具。除了让动画师的主要任务变得不那么乏味之外，电脑还添加了一些真正独特的能力，这些能力是以前根本无法获得或极其难以获得的。
现代建模工具允许相对容易地创建详细的三维模型，渲染算法可以产生令人印象深刻的外观，从完全逼真到高度风格化，强大的数值模拟算法可以帮助为特别难以动画的对象产生所需的基于物理的运动，运动捕捉系统提供了记录和使用真实运动的能力。
这些发展导致了计算机动画技术在电影和广告、汽车设计和建筑、医学和科学研究以及许多其他领域的爆炸式使用。全新的领域和应用也出现了，包括全电脑动画电影、虚拟/增强现实系统，当然还有电脑游戏。

本书的其他章节更直接地涵盖了上面提到的许多发展(例如，几何建模和渲染)。在这里，我们将只提供直接用于创建和操纵运动的技术和算法的概述。

特别地，我们将大致区分并简要描述四种主要的计算机动画方法：
1. 关键帧为动画师提供了最直接的控制，动画师在某些时刻提供必要的数据，计算机填充其余部分
2. 程序动画包括定制的动画，这些通常是通过经验，数学函数和程序来制作的，其输出类似于某些特定的动作。•
3. 基于物理的技术解决运动微分方程。•
4. 动作捕捉使用特殊的设备或技术来记录真实世界的运动，然后将这种运动转移到计算机模型中。
## 16.1 动画原理
在他1987年开创性的SIGGRAPH论文中，约翰·拉塞特将早在20世纪30年代由沃尔特·迪斯尼工作室的传统动画师开发的关键原理引入了当时刚刚起步的计算机动画社区。
他提出了12个原则（动画12原则）：挤压和拉伸、时间点、预期、跟进和重叠动作、慢进和慢出、舞台、弧线、次级动作、直接前进和姿势到姿势的动作、夸张、扎实的绘画技巧和吸引力。
近二十年后，这些经过时间考验的规则依然重要，它们可以区分自然而有趣的动画和机械而无聊的动画。
此外，对于计算机动画来说，充分利用计算机的能力，给予动画师平衡控制和灵活性是非常重要的。虽然这些原则是众所周知的，但许多因素影响着人们在实践中对这些规则的关注程度。虽然制作故事片的角色动画师可能会花很多时间来遵循这些原则，但许多游戏设计师倾向于认为他们的时间应该花在其他地方。
### 16.1.1 时间点（Timing）
时间，或者说动作的速度，是任何动画的核心。事情发生的速度会影响动作的意义、情绪状态，甚至涉及到物体的感知重量。
根据动作速度的不同，角色的头部从左向右转动可能意味着被重物击中后的反应，也可能是在书架上慢慢找书或伸展颈部肌肉。为手头的具体行动设定合适的时机是非常重要的。动作应该占用足够的时间以引起注意，同时避免过于缓慢和潜在的无聊动作。

对于涉及录制声音的计算机动画项目，声音提供了一个自然的定时锚。事实上，在大多数制作中，演员的声音是首先录制的，然后完整的动画与此录音同步。
由于大而重的物体往往比小而轻的物体移动得慢(更准确地说，加速度更小)，所以时间可以用来提供关于物体重量的重要信息。
### 16.1.2 动作的布局（Action Layout）
在动画的任何时刻，应当向观众清晰的表达动画的想法(动作、情绪、表情)。好的舞台或高层次的行动计划，应该引导观众的眼睛到重要的行动目前集中的地方，有效地告诉他“看这个，现在，看这个”，而不用任何语言。
对人类感知的一些熟悉的先验知识可以帮助我们完成这项艰巨的任务。由于人类的视觉系统主要对刺激物的**相对变化**作出反应，而不是对刺激物的**绝对值**作出反应，因此静止环境中的突然运动或繁忙场景中某些部分的缺乏运动自然会引起人们的注意。
与正面布局相比，呈现相同的动作，物体的轮廓会发生变化，这通常会让动作更加显眼。
![](pic/Pasted%20image%2020240403101248.png)
> 动作的布局（视角）很重要，在左边两张图中，左上的角色抬起左臂很明显，相反，对于左下的角色，观众很可能意识不到她有抬起左臂。

在较低的层次上，每个行动可以分成三个部分:预期(行动的准备)、行动本身和后续行动(行动的结束)。在许多情况下，行动本身是最短的部分，在某种意义上，也是最无趣的部分。
例如，踢球可能涉及到踢球者的大量准备工作和对离开的球的长时间“视觉跟踪”，并有充分的机会显示踢球者的压力、情绪状态，甚至是对动作预期结果的反应。动作本身(腿踢球的动作)相当简单，在这种情况下只需要几分之一秒。

动作的预期的目标是观众，目的是让观众对即将发生的动作有所准备。如果动作本身非常快、或者对动画的叙事很重要时，动画预期的作用就显得很重要了。
创建对此类行动的更广泛的动画预期有助于突出这些动作，并在快速事件的情况下确保观众不会穿过它们。

在现实生活中，主要动作往往会引起一个或多个其他**重叠动作**。对象的不同附件或松散部分通常拖到主引导部分的后面（附件相对于主动作有一定的延迟），并在主动作之后继续移动一段时间。
此外，下一次行动往往在前一次行动完全结束之前就开始了。球员可以在他还在追踪他刚才踢的球的时候就开始奔跑。忽视这种自然流动通常被认为是动作之间有停顿，并可能导致类似机器人的机械运动。
虽然重叠是必要的，以保持运动的自然，但动画制作人经常添加辅助动作，以使运动更有趣，并实现动画的逼真复杂性。更重要的是，不要让次要行动主导主要行动。
### 16.1.3 动画技术
可以使用几种特定的技术来使运动看起来更自然。最重要的可能是挤压和拉伸，它建议在移动的物体移动时以特定的方式改变其形状。人们通常会沿运动方向拉伸物体，并在施加力时将其挤压。
![](pic/Pasted%20image%2020240403102610.png)
以上这是一个弹跳球的经典动画。保存总体积是很重要的，因为这恰好避免了物体增大或缩小的影响。运动速度(或力)越大，伸展(或挤压)就越多。

使用这种变形有几个原因。
对于非常快的运动，对象可以在两个连续的帧之间快速移动，以至于在当前帧和前一帧的对象之间没有重叠，这可能会导致选频闪（Strobing）（伪影的一种变体）。让物体朝运动方向拉长可以确保更好的重叠，并帮助眼睛对抗这种令人不快的影响。
拉伸/挤压也可以用来显示对象的灵活性，更多的变形应用于更柔韧的材质。如果对象要显示为刚性，则其形状在移动时故意保持不变。

自然运动很少沿着直线发生，因此在动画中通常应该避免这种情况，而应该使用圆弧。
同样，现实世界中的任何运动都不能立即改变其速度——这将需要对对象施加无限大的力。在动画中也希望避免这样的情况。特别是，运动应该逐渐开始和结束(慢进和慢出)。
![](pic/Pasted%20image%2020240403103405.png)
手绘动画有时是通过直接的动作完成的，动画师从第一帧开始，按顺序绘制一帧又一帧，直到结束。而姿势到姿势的动作，也称为关键帧，更适合于计算机动画。在这种技术中，动画是通过一系列相对稀疏的关键帧精心规划的，其余的动画(中间帧)只有在设置关键帧后才填充。
这允许更精确的设定时机，并且可以通过下一节中介绍的算法来接管过程中最繁琐的部分——创建中间帧。

上面概述的几乎所有技巧都可以通过合理的夸张来达到更好的艺术效果，或者强调动作或角色的某些特定性质。最终目标是实现一些观众想要看到的东西，一些吸引人的东西。极端复杂或过于对称的角色或动作往往不那么吸引人。
要创造出好的效果，传统的动画师需要扎实的绘画技能。类似地，计算机动画师当然应该理解计算机图形学，并对他使用的工具有扎实的知识。
### 16.1.4 动画师控制方法 vs. 自动化方法
在传统动画中，动画师完全控制着制作过程的所有方面，正如在所有地方计划好的细节，没有什么能影响最后的成品效果。为这种灵活性付出的代价是，每一帧都是手工创建的，导致极其耗时和耗力。
在计算机动画中，则有更多的权衡：一方面如果让动画师对结果有更直接的控制，这时就要求他付出更多的工作；另一方面，如果依赖更多的自动化技术，这些技术也许只需要设置几个输入参数就能得到效果，但几乎不能控制结果的某些属性。
一个好的算法应该提供足够的灵活性，同时只要求动画师提供直观、容易提供的信息，以及他自己认为达到预期效果所必需的信息。虽然在实践中完全遵守这一要求是不太可能的，因为这可能需要某种接近读心机的东西，但我们确实鼓励读者从提供这种平衡的角度来评估任何计算机动画技术。
## 16.2 关键帧
当术语”关键帧“被应用在3D计算机动画中时可能被误解，毕竟它并非图像那样完整的一帧。
在任何给定的时刻，要动画的 3D 场景由一组数字指定：所有对象的中心位置、它们的 RGB 颜色、应用于每个轴上每个对象的缩放量、对复杂对象的不同部分之间的建模转换、相机位置和方向、光源强度等。
为了对场景进行动画处理，这些值的某些子集必须**随时间变化**。当然，人们可以直接在每一帧设置这些值，但这不是一种高效的做法。我们有一种简化的方法：选择在时间轴上的一些重要时刻（关键帧），为这个时刻确定特定属性的值（键值）。我们将帧和值的组合 (tk, fk) 称为键。
![](pic/Pasted%20image%2020240403104912.png)
对于不同的参数，关键帧不必相同，但至少为其中一些同时设置键通常是合乎逻辑的。例如，为特定对象的 x、y 和 z 坐标选择的关键帧可能设置在同一帧上，形成单个位置向量键 (tk, pk)。
然而，这些关键帧可能与为对象方向或颜色选择的那些完全不同。关键帧越接近彼此，动画师对结果的控制就越多。然而，我们必须权衡设置更多关键帧带来的工作上的成本。因此，在相对简单的动作上设置较少的关键帧，而在拥有复杂动画的地方设置更多的关键帧。

一旦动画器设置键值对 (tk, fk)，系统必须为所有其他帧计算值。尽管我们最终只对一组离散的值感兴趣，但将其视为通过一组离散点拟合连续动画曲线 f (t) 的经典插值问题会很容易理解。
由于动画师最初只提供键而不是导数(切线)，直接从键计算所有必要信息的方法更适合动画插值。沿曲线参数变化的速度由曲线相对于 time 的导数给出。因此，为了避免速度突然跳跃，通常需要C1连续性。
动画曲线通常不需要更高程度的连续性，因为对应于加速度或施加力的二阶导数可以在现实世界中经历非常突然的变化（击中固体墙的球），并且较高的导数并不直接对应于物理运动的任何参数（较高阶数的导数没什么物理意义）。这些考虑使得 Catmull-Rom 样条成为创建动画曲线的最佳选择之一。

大多数动画系统为动画师提供了对该初始曲线进行交互式微调的能力，包括插入更多的键、调整现有键或修改自动计算的切线。
另一种有助于调整曲线形状的有用技术称为TCB控制(TCB代表张力T、连续性C和偏差B)。这个想法是引入三个新参数，通过调整关键点的两个切线（进切线和出切线）来修改关键点附近曲线的形状。对于在时间轴上均匀间隔Δt的键，关键帧上输入切向和输出切向在标准Catmull-Rom表达式中可以写成（C1连续）：
![](pic/Pasted%20image%2020240403114943.png)
![](pic/Pasted%20image%2020240403115134.png)
张力参数 t 通过缩放传入和传出的切线来控制键附近曲线的锐度。较大的切线(较低的张力)导致键附近的平坦曲线形状。
偏差 b 允许选择性地增加键邻居键的权重，局部拉近连接键与其左（b 接近 1，是“超调”动作）或右（b接近 -1，则是“下冲”动作）邻居键的直线。
连续性 c 的非零值使传入和传出切线不同，允许动画师在键值的曲线中创建扭结。
实际上，TCB 参数的有用值通常仅限于区间 [−1; 1]，默认值 t = c = b = 0 对应于原始 Catmull-Rom 样条。
### 16.2.1 运动控制
到目前为止，我们已经讲了如何通过设定键的位置和微调键处的切线值来控制动画曲线的形状。然而，当人们想要同时控制物体运动的位置和速度时，这通常是不够的。
给定空间中的一组位置作为键，自动曲线拟合技术可以通过它们拟合曲线，但产生的运动轨迹仅受到强制对象到达相应关键帧 tk 处的指定关键点位置 pk 的约束，并且没有直接包含关于键之间的运动速度。
这可能会产生问题。例如，如果一个对象沿 x 轴移动，首先以每秒11米的速度移动一秒，然后以每秒1米的速度移动9秒，它将在 10 秒后到达位置 x = 20，从而满足动画师的键 (0,0) 和 (10, 20)。然而实际上，我们并不希望这种抖动运动，或许速度为 2 米/秒的均匀运动可能更接近动画师的期望。
![](pic/Pasted%20image%2020240408100723.png)
虽然通常不会展示出这种极端的行为，由标准拟合过程产生的多项式曲线有时会显示出关键点之间的运动速度不均匀，如图16.7所示。
虽然在一定容忍范围内，人类的视觉系统对某些参数的微小变化感知不明显（例如颜色和旋转上的变化），但我们必须确定好位置和速度的属性，其中速度直接对应于日常经验。

我们将首先区分在**拟合过程中**使用的曲线参数化和**用于动画**的曲线参数化。
当曲线通过位置键进行拟合时，我们将结果写成某个参数u的函数p(U)，它描述曲线在空间中的几何形状。弧长S是曲线的物理长度。
动画师控制沿现有曲线运动的一种自然方法是指定额外的函数s(t)，该函数对应于对象在任何给定时间应该沿曲线走多远。
为了得到空间中的实际位置，我们还需要一个辅助函数u(s)，它计算给定弧长S的参数值u。然后通过组合这些函数给出计算给定时间t的物体位置的完整过程：
$$p(t)=P(u(s(t)))$$
![](pic/Pasted%20image%2020240408101811.png)

有几个标准函数可以用作 距离-时间 函数s（t）。
其中最简单的是对应于恒定速度的线性函数：s（t）= vt，是常值。另一个常见的例子是具有恒定加速度a（和初始速度vo）的运动，它由抛物线s（t）= V0 t + at^2/2来描述。由于速度在这里是逐渐变化的，所以这个函数可以帮助建模理想的缓进和缓出行为。更一般地，如果s（t）的斜率为负，那么它对应于沿着曲线向后的运动。
为了实现最大的灵活性， 交互式编辑s(t)通常由动画系统提供给动画师。距离-时间函数并不是控制运动的唯一方法。在某些情况下，用户指定速度-时间函数v(t)甚至加速度-时间函数a(t)可能更方便。由于它们对应的是s(t)的一阶导数和二阶导数，为了使用这些类型的控制，系统首先通过积分用户输入(在a(t)的情况下两次)来恢复距离-时间函数。

曲线参数u与弧长s之间的关系由系统自动建立。
在实际中，系统首先根据参数u(即反函数s(u))确定弧长。使用这个函数，对于任何给定的S，都可以解出方程S (u)−S = 0而未知的u(S)。对于大多数曲线，函数s(u)没有解析解，必须进行数值积分。标准的数值求根程序例如牛顿法可以直接用于解方程s(u)−s = 0。

另一种方法是将曲线本身近似为点pi之间的一组线性线段，这些线段是在一组足够密集的参数值ui上计算得到的。然后创建一个近似弧长表

![](pic/Pasted%20image%2020240408102704.png)
## 16.3 变形
## 16.4 角色动画
## 16.5 基于物理的动画
## 16.6 程序化技术
## 16.7 物体组